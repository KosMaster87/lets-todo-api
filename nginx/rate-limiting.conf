# ============================================================================
# Rate Limiting Configuration for nginx.conf
# Add this to your main nginx.conf in the http block
# ============================================================================

# Rate limiting zones
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=api_burst:10m rate=50r/s;

# Rate limiting for different environments
map $host $rate_limit_zone {
    default                             api_limit;
    api.lets-todo.dev2k.org             api_limit;
    feature.api.lets-todo.dev2k.org     api_burst;
    staging.api.lets-todo.dev2k.org     api_limit;
}

# Logging configuration
log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                '$status $body_bytes_sent "$http_referer" '
                '"$http_user_agent" "$http_x_forwarded_for" '
                'rt=$request_time uct="$upstream_connect_time" '
                'uht="$upstream_header_time" urt="$upstream_response_time"';

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;